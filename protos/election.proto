syntax = "proto3";

package election;

// Messages used for the Bully election algorithm
message Node {
  // Unix epoch time in milliseconds used as the node's numeric id.
  // ms to indicate the time a node was elected as a leader.
  int64 id = 1; // unix ms timestamp

  string addr = 2; // transport address (host:port) to contact this node
}

message ElectionRequest {
  Node from = 1; // who is starting the election
}

message ElectionResponse {
  bool ok = 1; // indicates higher-id node is alive and will take over election
  Node responder = 2; // the responding node with current ID (Modified Bully Step 2(ii))
}

message Coordinator {
  Node leader = 1; // announced leader node
}

message PingRequest {
  Node from = 1;
}

message PingResponse {
  bool alive = 1;
}

// Service exposing the basic RPCs used by the Bully algorithm.
service Bully {
  // Called by a node to notify higher-id nodes that it starts an election.
  rpc Election(ElectionRequest) returns (ElectionResponse);

  // Announces the final leader to all nodes.
  rpc AnnounceCoordinator(Coordinator) returns (PingResponse);

  // Modified Bully Step 2(iv): Notify a node that it should become coordinator
  // and validate itself before announcing.
  rpc NotifyCoordinator(Coordinator) returns (PingResponse);

  // Simple ping used to check aliveness.
  rpc Ping(PingRequest) returns (PingResponse);
}
